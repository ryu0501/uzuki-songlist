<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>兎月詩 歌える曲一覧</title>
  <style>
    body {
      text-align: center;
      background-color: #fff;
      margin: 0;
      padding: 0;
    }

    h2 {
      margin-top: 20px;
    }

    table {
      width: 99%;
      border-collapse: collapse;
      margin: 20px auto;
      font-size: 20px;
    }

    th, td {
      border: 1px solid black;
      padding: 8px;
      text-align: left;
    }

    th {
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    .highlight {
      background-color: yellow;
      border: 1px solid black;
    }

    .artist-name {
      width: 200px;
    }

    .song-name {
      width: 300px;
    }

    .song-id {
      width: 50px;
    }

    #searchInput {
      margin: 20px 0;
      padding: 7px;
      width: 50%;
      font-size: 40px;
      box-sizing: border-box;
    }

    /* モバイル対応 */
    @media (max-width: 767px) {
      .artist-name { width: 100px; }
      .song-name { width: 200px; }
      table { width: 100%; }
      #searchInput { width: 80%; }
    }
  </style>
</head>
<body>

<h2>兎月詩 歌える曲一覧</h2>
<input type="text" id="searchInput" placeholder="検索...">
<table id="songsTable">
  <thead>
    <tr>
      <th class="artist-name" onclick="sortTable(0)">アーティスト名</th>
      <th class="hidden">アーティスト名読み仮名</th>
      <th class="song-name" onclick="sortTable(2)">曲名</th>
      <th class="hidden">曲名読み仮名</th>
      <th class="song-id" onclick="sortTable(4)">管理番号</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  function normalizeString(str) {
    return str.replace(/[Ａ-Ｚａ-ｚ０-９]/g, s =>
      String.fromCharCode(s.charCodeAt(0) - 0xFEE0)).toUpperCase();
  }

  document.getElementById("searchInput").addEventListener("input", function () {
    const filter = normalizeString(this.value);
    const rows = document.querySelector("#songsTable tbody").rows;

    for (const row of rows) {
      const [artistTd, artistPhoneticTd, songTd, songPhoneticTd, songIdTd] = row.cells;
      const artist = normalizeString(artistTd.textContent);
      const artistPhonetic = normalizeString(artistPhoneticTd.textContent);
      const song = normalizeString(songTd.textContent);
      const songPhonetic = normalizeString(songPhoneticTd.textContent);
      const songId = normalizeString(songIdTd.textContent);

      const match = artist.includes(filter) || artistPhonetic.includes(filter)
                 || song.includes(filter) || songPhonetic.includes(filter)
                 || songId.includes(filter);

      row.style.display = match ? "" : "none";
      artistTd.classList.toggle("highlight", match && (artist.includes(filter) || artistPhonetic.includes(filter)));
      songTd.classList.toggle("highlight", match && (song.includes(filter) || songPhonetic.includes(filter)));
    }
  });

  function sortTable(n) {
    const table = document.getElementById("songsTable");
    const rows = Array.from(table.tBodies[0].rows);
    rows.sort((a, b) => a.cells[n].textContent.localeCompare(b.cells[n].textContent));
    rows.forEach(row => table.tBodies[0].appendChild(row));
  }

  function loadCSV() {
    fetch("songs.csv")
      .then(response => response.text())
      .then(csv => {
        const lines = csv.trim().split("\n").slice(1); // Skip header
        const tbody = document.querySelector("#songsTable tbody");
        tbody.innerHTML = "";
        lines.forEach((line, index) => {
          const [artist, artistPhonetic, song, songPhonetic] = line.split(",");
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="artist-name">${artist}</td>
            <td class="hidden">${artistPhonetic}</td>
            <td class="song-name">${song}</td>
            <td class="hidden">${songPhonetic}</td>
            <td class="song-id">${String(index + 1).padStart(3, "0")}</td>
          `;
          tbody.appendChild(row);
        });
      });
  }

  loadCSV();
</script>

</body>
</html>
